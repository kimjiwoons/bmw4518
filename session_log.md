# 프로젝트 세션 로그

## 메타 정보
- 프로젝트명: GeeLark ADB 네이버 검색 자동화
- 시작일: 2025-12-29
- 마지막 업데이트: 2025-12-29
- 현재 세션: #1

---

## 프로젝트 개요

네이버 모바일 검색에서 특정 도메인을 찾아 클릭하는 SEO 자동화 도구.
삼성 브라우저에서 CDP 좌표 불일치 문제로 템플릿 매칭 방식으로 전환 중.

---

## 완료된 작업
| 번호 | 작업명 | 수정/생성 파일 | 상세 내용 | 결과 |
|------|--------|----------------|-----------|------|
| 1 | OCR → 템플릿 매칭 교체 | adb/adb_auto.py | easyocr 제거, OpenCV 템플릿 매칭으로 교체. find_template() 메서드 추가 | 성공 |
| 2 | step5 삼성 브라우저 템플릿 매칭 | adb/adb_auto.py | CDP 없이 순수 ADB + 템플릿 매칭으로 "검색결과 더보기" 찾기 | 성공 |
| 3 | step6 삼성 브라우저 템플릿 매칭 | adb/adb_auto.py | 템플릿 매칭으로 클릭, 버튼 사라짐으로 페이지 전환 감지 | 성공 |
| 4 | 모바일 CDP 전체 비활성화 | adb/adb_auto.py | 탐지 위험 제거 위해 모든 브라우저 CDP 연결 비활성화 | 성공 |
| 5 | test_ocr.py 삭제 | adb/test_ocr.py | OCR 테스트 파일 제거 | 성공 |
| 6 | step7 삼성 브라우저 도메인 찾기 | adb/adb_auto.py | 템플릿 매칭으로 도메인 찾기, 서브링크 영역 제외, 무한 재시도 로직 구현 | 성공 |
| 7 | 삼성 브라우저 "계속" 버튼 처리 | adb/adb_auto.py | first_run_buttons에 "계속" 추가, _wait_for_page_load() 메서드 추가 | 성공 |

---

## 발생한 이슈 및 해결
| 이슈 | 원인 | 해결 방법 |
|------|------|-----------|
| CDP 좌표 불일치 | 삼성 브라우저 CDP 좌표가 실제 화면과 다름 | 템플릿 매칭으로 실제 화면 좌표 찾기 |
| easyocr 메모리 오류 | GPU 메모리 부족 | OpenCV 템플릿 매칭으로 대체 |
| pytesseract 한글 인식 불량 | 한글 글자 분리됨 | 템플릿 매칭으로 대체 |
| CDP 탐지 위험 | 서버에서 CDP 연결 감지 가능성 | 모바일 CDP 전체 비활성화 |
| 삼성 브라우저 "계속" 버튼 | 첫 화면에 "계속" 버튼 미처리 | first_run_buttons에 추가 + _wait_for_page_load() |

---

## 현재 진행 중

(없음)

---

## 다음 단계 (TODO)
- [x] step7: 도메인 찾기 (삼성 브라우저용 템플릿 매칭 방식 구현) ✓
- [ ] step4_5: 통합에서 도메인 찾기 (삼성 브라우저용)
- [ ] 도메인 텍스트 → 이미지 생성 → 템플릿 매칭 방식 검토
- [ ] 템플릿 파일 생성: template_domain.png, template_sublink.png

---

## 중요 결정사항 및 메모

### 삼성 브라우저 특이사항
- ADB XML(uiautomator)에서 웹 요소가 안 보임
- CDP 좌표가 실제 화면 좌표와 다름
- 해결: 템플릿 매칭 사용

### 탐지 방지
- 모바일에서 CDP 연결 안 함 (탐지 위험)
- 스크롤 계산은 PC CDP가 담당
- 모바일은 순수 ADB 터치/스크롤만 사용

### 템플릿 파일
- `adb/template_more.png`: "검색결과 더보기" 버튼 템플릿
- `adb/template_domain.png`: 도메인 영역 템플릿 (step7용) - 생성 필요
- `adb/template_sublink.png`: 서브링크 영역 템플릿 (클릭 제외용) - 생성 필요
- 임계값: 0.7

### ADB 명령어
```bash
# 스크린샷
adb -s 98.98.125.37:21306 exec-out screencap -p > screenshot.png
```
